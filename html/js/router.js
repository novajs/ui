/**
 * Page Router.
 *
 * @author Jared Allard <jaredallard@outlook.com>
 * @version 1.0.0
 * @license MIT
 **/
"use strict";function _classCallCheck(e,o){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,o){for(var t=0;t<o.length;t++){var n=o[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(o,t,n){return t&&e(o.prototype,t),n&&e(o,n),o}}(),Route=function(){function e(o,t){_classCallCheck(this,e),console.log("constructed a new route"),o&&(this._path=o),t&&(this._code=t)}return _createClass(e,[{key:"use",value:function(e){this._code=e}},{key:"path",value:function(e){this._path=e}}]),e}(),Router=function(){function e(){_classCallCheck(this,e),console.log("constructed router."),this.active=!1,this.routes=[],this.binds=[]}return _createClass(e,[{key:"hook",value:function(){var e=this;this.active=!0,console.log("router hooked into page.");var o=function(){console.log("router: started pace");var o=document.location.hash.replace(/^#/,"");""===o&&(o="/"),console.log("router: page ->",o),$("#dom").css("background","#FFFFFF"),$("#dom").html("");var t=0;e.routes.forEach(function(n){n.path===o&&(console.log("router: page hit on index:",t),console.log("router: route ->",n),n.code(function(){$(document).ready(function(){console.log("router: finished loading anything"),console.log("router: executing bind(s)"),e.binds.forEach(function(e){e.code()}),Pace.stop()})}),t++)})};window.onhashchange=function(){Pace.start({document:!1}),o()},o()}},{key:"isActive",value:function(){return this.active}},{key:"use",value:function(e){return!(!e._path||!e._code)&&(this.routes.push({path:e._path,code:e._code,object:e}),void console.log("registered route",e._path,"onto Router"))}},{key:"bind",value:function(e){this.binds.push({code:e}),console.log("router: new bind added, total:",this.binds.length)}}]),e}(),triton=new Triton($),router=new Router,login=new Route("/login");login.use(function(e){return $.cookie("triton_userapikey")?(console.log("LOGIN: already set cookie, go ahead..."),window.location.hash="/dashboard"):($("#dom").html(TRITON.templates.login()),e())});var register=new Route("/register");register.use(function(e){return $("#dom").html(TRITON.templates.register()),e()});var index=new Route("/");index.use(function(e){return $("#dom").html(TRITON.templates.index()),e()});var dash=new Route("/dashboard");dash.use(function(e){return $.cookie("triton_userapikey")?void triton.get("users").then(function(o){var t=gravatar(o.email,{size:200}),n=o.display_name;triton.get("assignments/list").then(function(o){return o.forEach(function(e){var o=(e.created,new moment(e.created).format("MM/DD/YY"));console.log("eval date to",o),e.json=JSON.stringify(e),e.created=o}),$("#dom").html(TRITON.templates.dashboard({header:TRITON.templates.dash_header({image:t,info:n}),assignments:o,footer:TRITON.templates.dash_footer()})),e()})}):window.location.hash="/login"});var sett=new Route("/dashboard/settings");sett.use(function(e){triton.get("users").then(function(o){var t=gravatar(o.email,{size:200}),n=o.display_name;return $("#dom").html(TRITON.templates.settings({header:TRITON.templates.dash_header({image:t,info:n}),footer:TRITON.templates.dash_footer(),display_name:o.display_name,email:o.email})),e()})});var logout=new Route("/dashboard/logout");logout.use(function(e){return triton.invalidateCache("assignments/list"),$.removeCookie("triton_userapikey",{path:"/",domain:window.API_CONFIG.cdomain}),$.removeCookie("triton_username",{path:"/",domain:window.API_CONFIG.cdomain}),$.removeCookie("triton_isadmin"),window.location.href="/",console.log("DEBUG: cdomain ->",window.API_CONFIG.cdomain),console.log("LOGIN: Logged out current user"),e()});var loading=new Route("/workspace");loading.use(function(e){return $("#dom").html(TRITON.templates.loading()),e()});var assigninfo=new Route("/dashboard/assignment");assigninfo.use(function(e){if(!$.cookie("triton_assignmentinfo"))return window.location.hash="/dashboard";var o;try{o=JSON.parse($.cookie("triton_assignmentinfo"))}catch(t){return $.cookie("triton_assignmentinfo",void 0),window.location.hash="/dashboard"}triton.get("users").then(function(t){var n=gravatar(t.email,{size:200}),a=t.display_name;return $("#dom").html(TRITON.templates.assigninfo({header:TRITON.templates.dash_header({image:n,info:a}),footer:TRITON.templates.dash_footer(),assignment:o})),e()})});var admindash=new Route("/admin");admindash.use(function(e){triton.get("users").then(function(o){console.log("users:",o);var t=gravatar(o.email,{size:200}),n=o.display_name;return $("#dom").html(TRITON.templates.admindash({header:TRITON.templates.admindash_header({image:t,info:n}),name:o.display_name.split(" ")[0],footer:TRITON.templates.dash_footer()})),e()})}),router.use(index),router.use(login),router.use(dash),router.use(admindash),router.use(sett),router.use(logout),router.use(loading),router.use(register),router.use(assigninfo),window.ROUTER=router,router.hook();