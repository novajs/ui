"use strict";function updateUserInfo(e,a,o){var i=a.val(),r=e.val(),n=o.val();if(!i)return a.parent().addClass("has-error");var t=[{type:"email",val:r},{type:"display_name",val:n}],s={};t.forEach(function(e){return""===e.val||"undefined"==typeof e.val||null===e.val||" "===e.val?void console.log("invalid value for opt type:",e.type):void(s[e.type]=e.val)}),triton.post("users/update",s).then(function(e){triton.invalidate("users")})["catch"](function(e){console.log(e)})}var triton=new Triton($),gravatar=function(e,a){var o,a=a||{},i=[];return a={size:a.size||"50",rating:a.rating||"g",secure:!0,backup:"https://tritonjs.com/css/img/user.png"},e=e.trim().toLowerCase(),o=a.secure?"https://secure.gravatar.com/avatar/":"http://www.gravatar.com/avatar/",a.rating&&i.push("r="+a.rating),a.backup&&i.push("d="+encodeURIComponent(a.backup)),a.size&&i.push("s="+a.size),o+md5(e)+"?"+i.join("&")},main=function(){var e=$.cookie("triton_useremail");if(e){$("#login-email").val(e);var a=gravatar(e,{size:"100",backup:$("#login-image").attr("src")});$("#login-image").attr("src",a),$("#login-image").attr("data-md5",md5(e))}$("#login-email").on("focusout",function(){var e=$("#login-email").val();if(md5(e)===$("#login-image").attr("data-md5"))return void console.log("MD5 is same, ignore.");if(""!==e&&null!=e&&" "!==e){var a=gravatar(e,{size:200,backup:$("#login-image").attr("src")});console.log("email",e),console.log("gravatar",a),$("#login-image").attr("src",a),$("#login-image").attr("data-md5",md5(e))}}),$("#login-submit").on("click",login),$.material.init()},login=function(){$("#login-error").hide(),console.log("BEGIN LAUNCH SEQUENCES");var e=$("#login-email").val();if(e&&" "!==e&&""!==e){console.log("set triton_useremail cookie"),$.cookie("triton_useremail",e);var a=$("#login-email").val(),o=$("#login-password").val();console.log("POST:",a,"<pass>"),$.ajax({type:"POST",headers:{"Content-Type":"application/json"},url:triton.url+"/users/authflow",data:JSON.stringify({email:a,password:o}),success:function(e){if(!e)return console.error("Invalid Response from Server",e);if(e.success||console.error("Recieved success=false",e),!e.success)return $("#login-error").show();console.log("login: writing cookies to API_CONFIG.cdomain ->",window.API_CONFIG.cdomain);var a=e.data["public"]+":"+e.data.secret;$.cookie("triton_userapikey",a,{path:"/",domain:window.API_CONFIG.cdomain}),$.cookie("triton_username",e.data.username,{path:"/",domain:window.API_CONFIG.cdomain}),window.location.hash="/dashboard"}})}},register=function(){$("#register-submit").html('<img src="css/img/balls.gif" />');var e=$("#register-email").val(),a=$("#register-password").val(),o=$("#register-un").val(),i=$("#register-dn").val();$.ajax({type:"POST",headers:{"Content-Type":"application/json"},url:triton.url+"/users/new",data:JSON.stringify({email:e,password:a,display_name:i,username:o}),success:function(e){return e?(e.success||console.error("Recieved success=false",e),e.success||"USER_EXISTS"===e.data&&errorElem($("#un-form")),void(window.location.href="/#/login")):console.error("Invalid Response from Server",e)}})},assignment=function(e){console.log("I: Start assignment ->",e),window.location.href="/#/workspace",localStorage.setItem("assignment_id",e)};router&&(console.log("ui is binding to router."),window.ROUTER.bind(main)),$(document).ready(function(){$(window).keydown(function(e){if(13==e.keyCode)return e.preventDefault(),!1})});