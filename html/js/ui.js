"use strict";function updateUserInfo(o,a,e){var i=a.val(),n=o.val(),r=e.val();if(!i)return a.parent().addClass("has-error");var t=[{type:"email",val:n},{type:"display_name",val:r}],s={};t.forEach(function(o){return""===o.val||"undefined"==typeof o.val||null===o.val||" "===o.val?void console.log("invalid value for opt type:",o.type):void(s[o.type]=o.val)}),triton.post("users/update",s).then(function(o){triton.invalidate("users")})["catch"](function(o){console.log(o)})}var triton=new Triton($),gravatar=function(o,a){var e,a=a||{},i=[];return a={size:a.size||"50",rating:a.rating||"g",secure:!0,backup:"https://tritonjs.com/css/img/user.png"},o=o.trim().toLowerCase(),e=a.secure?"https://secure.gravatar.com/avatar/":"http://www.gravatar.com/avatar/",a.rating&&i.push("r="+a.rating),a.backup&&i.push("d="+encodeURIComponent(a.backup)),a.size&&i.push("s="+a.size),e+md5(o)+"?"+i.join("&")},main=function(){var o=$.cookie("triton_useremail");if(o){$("#login-email").val(o);var a=gravatar(o,{size:"100",backup:$("#login-image").attr("src")});$("#login-image").attr("src",a),$("#login-image").attr("data-md5",md5(o))}$("#login-email").on("focusout",function(){var o=$("#login-email").val();if(md5(o)===$("#login-image").attr("data-md5"))return void console.log("MD5 is same, ignore.");if(""!==o&&null!=o&&" "!==o){var a=gravatar(o,{size:200,backup:$("#login-image").attr("src")});console.log("email",o),console.log("gravatar",a),$("#login-image").attr("src",a),$("#login-image").attr("data-md5",md5(o))}}),$("#login-submit").on("click",login),$.material.init()},login=function(){$("#login-error").hide(),console.log("BEGIN LAUNCH SEQUENCES");var o=$("#login-email").val();if(o&&" "!==o&&""!==o){console.log("set triton_useremail cookie"),$.cookie("triton_useremail",o);var a=$("#login-email").val(),e=$("#login-password").val();console.log("POST:",a,"<pass>"),$.ajax({type:"POST",headers:{"Content-Type":"application/json"},url:triton.url+"/users/authflow",data:JSON.stringify({email:a,password:e}),success:function(o){if(!o)return console.error("Invalid Response from Server",o);if(o.success||console.error("Recieved success=false",o),!o.success)return $("#login-error").show();console.log("login: writing cookies to API_CONFIG.cdomain ->",window.API_CONFIG.cdomain);var a=o.data["public"]+":"+o.data.secret;return $.cookie("triton_userapikey",a,{path:"/",domain:window.API_CONFIG.cdomain}),$.cookie("triton_username",o.data.username,{path:"/",domain:window.API_CONFIG.cdomain}),"admin"===o.data.role?($.cookie("triton_isadmin",!0),window.location.hash="/admin"):void(window.location.hash="/dashboard")}})}},register=function(){$("#register-submit").html('<img src="css/img/balls.gif" />');var o=$("#register-email").val(),a=$("#register-password").val(),e=$("#register-un").val(),i=$("#register-dn").val();$.ajax({type:"POST",headers:{"Content-Type":"application/json"},url:triton.url+"/users/new",data:JSON.stringify({email:o,password:a,display_name:i,username:e}),success:function(o){return o?(o.success||console.error("Recieved success=false",o),o.success||"USER_EXISTS"===o.data&&errorElem($("#un-form")),void(window.location.href="/#/login")):console.error("Invalid Response from Server",o)}})},assignment=function(o){console.log("I: Start assignment ->",o),window.location.href="/#/workspace",localStorage.setItem("assignment_id",o)};router&&(console.log("ui is binding to router."),window.ROUTER.bind(main)),$(document).ready(function(){$(window).keydown(function(o){if(13==o.keyCode)return o.preventDefault(),!1})});