"use strict";function updateUserInfo(a,e,o){var i=e.val(),n=a.val(),r=o.val();if(!i)return e.parent().addClass("has-error");var t=[{type:"email",val:n},{type:"display_name",val:r}],s={};t.forEach(function(a){return""===a.val||"undefined"==typeof a.val||null===a.val||" "===a.val?void console.log("invalid value for opt type:",a.type):void(s[a.type]=a.val)}),triton.post("users/update",s).then(function(a){triton.invalidate("users")})["catch"](function(a){console.log(a)})}var triton=new Triton($),gravatar=function(a,e){var o,e=e||{},i=[];return e={size:e.size||"50",rating:e.rating||"g",secure:!0,backup:"https://tritonjs.com/css/img/user.png"},a=a.trim().toLowerCase(),o=e.secure?"https://secure.gravatar.com/avatar/":"http://www.gravatar.com/avatar/",e.rating&&i.push("r="+e.rating),e.backup&&i.push("d="+encodeURIComponent(e.backup)),e.size&&i.push("s="+e.size),o+md5(a)+"?"+i.join("&")},main=function(){var a=$.cookie("triton_useremail");if(a){$("#login-email").val(a);var e=gravatar(a,{size:"100",backup:$("#login-image").attr("src")});$("#login-image").attr("src",e),$("#login-image").attr("data-md5",md5(a))}$("#login-email").on("focusout",function(){var a=$("#login-email").val();if(md5(a)===$("#login-image").attr("data-md5"))return void console.log("MD5 is same, ignore.");if(""!==a&&null!=a&&" "!==a){var e=gravatar(a,{size:200,backup:$("#login-image").attr("src")});console.log("email",a),console.log("gravatar",e),$("#login-image").attr("src",e),$("#login-image").attr("data-md5",md5(a))}}),$("#login-submit").on("click",login),$.material.init()},login=function(){$("#login-error").hide(),console.log("BEGIN LAUNCH SEQUENCES");var a=$("#login-email").val();if(a&&" "!==a&&""!==a){console.log("set triton_useremail cookie"),$.cookie("triton_useremail",a);var e=$("#login-email").val(),o=$("#login-password").val();console.log("POST:",e,"<pass>"),$.ajax({type:"POST",headers:{"Content-Type":"application/json"},url:triton.url+"/users/authflow",data:JSON.stringify({email:e,password:o}),success:function(a){if(!a)return console.error("Invalid Response from Server",a);if(a.success||console.error("Recieved success=false",a),!a.success)return $("#login-error").show();console.log("login: writing cookies to API_CONFIG.cdomain ->",window.API_CONFIG.cdomain);var e=a.data["public"]+":"+a.data.secret;return $.cookie("triton_userapikey",e,{path:"/",domain:window.API_CONFIG.cdomain}),$.cookie("triton_username",a.data.username,{path:"/",domain:window.API_CONFIG.cdomain}),"admin"===a.data.role?(window.isadmin=!0,window.location.hash="/admin"):void(window.location.hash="/dashboard")}})}},register=function(){$("#register-submit").html('<img src="css/img/balls.gif" />');var a=$("#register-email").val(),e=$("#register-password").val(),o=$("#register-un").val(),i=$("#register-dn").val();$.ajax({type:"POST",headers:{"Content-Type":"application/json"},url:triton.url+"/users/new",data:JSON.stringify({email:a,password:e,display_name:i,username:o}),success:function(a){return a?(a.success||console.error("Recieved success=false",a),a.success||"USER_EXISTS"===a.data&&errorElem($("#un-form")),void(window.location.href="/#/login")):console.error("Invalid Response from Server",a)}})},assignment=function(a){console.log("I: Start assignment ->",a),window.location.href="/#/workspace",localStorage.setItem("assignment_id",a)};router&&(console.log("ui is binding to router."),window.ROUTER.bind(main)),$(document).ready(function(){$(window).keydown(function(a){if(13==a.keyCode)return a.preventDefault(),!1})});